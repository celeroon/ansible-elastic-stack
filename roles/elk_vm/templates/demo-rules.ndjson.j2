{"id": "0618760d-2475-4c11-8a63-80509b158191","created_by": "elastic","name": "Browser Download Archive/Executable Download Detection","tags": ["DEMO"],"interval": "1m","enabled": true,"revision": 0,"description": "This detection rule identifies potentially suspicious downloads executed through the Chrome browser by monitoring for files tagged with Zone.Identifier. These tags are applied to files downloaded from the internet and can indicate elevated risk if they are executable or compressed archives, such as .zip, .7z, .rar, .tar, .gz, .bz2, .iso, and .exe. The rule specifically targets events where the chrome.exe process is involved, and the file name includes the Zone.Identifier suffix. The goal is to detect and alert security teams about potentially malicious or unauthorized downloads that could pose a threat to the organization's security.","risk_score": 47,"severity": "medium","license": "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md","output_index": "","meta": {"from": "1s"},"author": ["celeroon"],"false_positives": [],"from": "now-61s","rule_id": "60ac850c-a803-47cf-8e07-0f362c907b8d","max_signals": 100,"risk_score_mapping": [],"severity_mapping": [],"threat": [{"framework": "MITRE ATT&CK","tactic": {"id": "TA0001","name": "Initial Access","reference": "https://attack.mitre.org/tactics/TA0001"},"technique": [{"id": "T1566","name": "Phishing","reference": "https://attack.mitre.org/techniques/T1566","subtechnique": [{"id": "T1566.001","name": "Spearphishing Attachment","reference": "https://attack.mitre.org/techniques/T1566/001"}]}]}],"to": "now","references": [],"version": 1,"exceptions_list": [],"immutable": false,"related_integrations": [],"required_fields": [],"setup": "","type": "esql","language": "esql","query": "FROM logs-* \n    METADATA _id, _version, _index\n| WHERE (event.code == \"11\")\n    AND process.name == \"chrome.exe\"\n    AND (file.name LIKE \"*.zip:Zone.Identifier\"\n        OR file.name LIKE \"*.7z:Zone.Identifier\"\n        OR file.name LIKE \"*.rar:Zone.Identifier\"\n        OR file.name LIKE \"*.tar:Zone.Identifier\"\n        OR file.name LIKE \"*.gz:Zone.Identifier\"\n        OR file.name LIKE \"*.bz2:Zone.Identifier\"\n        OR file.name LIKE \"*.iso:Zone.Identifier\"\n        OR file.name LIKE \"*.exe:Zone.Identifier\")\n| KEEP @timestamp, event.code, process.entity_id, process.pid, process.name, file.name, file.hash.md5, file.hash.sha1, file.hash.sha256, _id, _version, _index\n","actions": []}
{"id": "cef75f28-073b-438a-ae88-7834e954ddfc","created_by": "elastic","name": "Archive Execution via Windows Explorer ","tags": ["DEMO"],"interval": "1m","enabled": true,"revision": 0,"description": "This detection rule identifies potentially suspicious executable files with a Zone.Identifier tag that are associated with compressed archives. These files are executed through Windows Explorer (Explorer.EXE). The rule focuses on files with an .exe:Zone.Identifier tag, indicating they were downloaded from the internet and may pose a security risk. The rule monitors events where the executable file is associated with archive formats such as .zip, .7z, .rar, .tar, .gz, .bz2, and .iso. The presence of these files in the event data (winlog.event_data.Contents) suggests that the executable was potentially extracted from one of these archives, which is a common method for delivering malicious payloads.","risk_score": 47,"severity": "medium","license": "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md","output_index": "","meta": {"from": "1s"},"author": ["celeroon"],"false_positives": [],"from": "now-61s","rule_id": "5a49e2f3-dc2a-432c-96b0-024936d524f3","max_signals": 100,"risk_score_mapping": [],"severity_mapping": [],"threat": [{"framework": "MITRE ATT&CK","tactic": {"id": "TA0009","name": "Collection","reference": "https://attack.mitre.org/tactics/TA0009"},"technique": [{"id": "T1560","name": "Archive Collected Data","reference": "https://attack.mitre.org/techniques/T1560","subtechnique": [{"id": "T1560.001","name": "Archive via Utility","reference": "https://attack.mitre.org/techniques/T1560/001"}]}]}],"to": "now","references": [],"version": 1,"exceptions_list": [],"immutable": false,"related_integrations": [],"required_fields": [],"setup": "","type": "esql","language": "esql","query": "FROM logs-* \n    metadata _id, _version, _index\n| WHERE event.code == \"15\"\n    AND process.name == \"Explorer.EXE\"\n    AND (file.name LIKE \"*.exe:Zone.Identifier\")\n    AND (\n        winlog.event_data.Contents LIKE \"*.zip*\" OR\n        winlog.event_data.Contents LIKE \"*.7z*\" OR\n        winlog.event_data.Contents LIKE \"*.rar*\" OR\n        winlog.event_data.Contents LIKE \"*.tar*\" OR\n        winlog.event_data.Contents LIKE \"*.gz*\" OR\n        winlog.event_data.Contents LIKE \"*.bz2*\" OR\n        winlog.event_data.Contents LIKE \"*.iso*\"\n    )\n| KEEP event.code, @timestamp, process.name, file.name, file.hash.md5, file.hash.sha1, file.hash.sha256, _id, _version, _index","actions": []}
{"id": "500d029c-c37d-4a60-8e56-ec0dd13756ac","created_by": "elastic","name": "Suspicious Process Process/Application Execution","tags": ["DEMO"],"interval": "1m","enabled": true,"revision": 0,"description": "This detection rule is designed to identify the execution of cryptocurrency-related applications, specifically those associated with wallets or Bitcoin, through the Windows Explorer process. It monitors for processes with executable names that contain keywords such as wallet or bitcoin, indicating potential cryptocurrency wallet software or mining applications. The rule focuses on executable files (*.exe) initiated by explorer.exe, suggesting user interaction or potential unauthorized execution of cryptocurrency-related applications on the system.","risk_score": 73,"severity": "high","license": "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md","output_index": "","meta": {"from": "1s"},"author": ["celeroon"],"false_positives": [],"from": "now-61s","rule_id": "352d1ece-ddcb-4f7c-88f3-cd896161bf58","max_signals": 100,"risk_score_mapping": [],"severity_mapping": [],"threat": [{"framework": "MITRE ATT&CK","tactic": {"id": "TA0002","name": "Execution","reference": "https://attack.mitre.org/tactics/TA0002"},"technique": [{"id": "T1204","name": "User Execution","reference": "https://attack.mitre.org/techniques/T1204","subtechnique": [{"id": "T1204.002","name": "Malicious File","reference": "https://attack.mitre.org/techniques/T1204/002"}]}]}],"to": "now","references": [],"version": 1,"exceptions_list": [],"immutable": false,"related_integrations": [],"required_fields": [],"setup": "","type": "esql","language": "esql","query": "FROM logs-* metadata _id, _version, _index\n| WHERE (event.code == \"1\")\n    AND (\n        process.name LIKE \"*.exe\"\n        AND (\n            process.name LIKE \"*wallet*\"\n            OR process.name LIKE \"*bitcoin*\"\n        )\n    )\n    AND process.parent.name == \"explorer.exe\"\n| KEEP event.code, @timestamp, process.entity_id, process.pid, process.name, file.hash.md5, file.hash.sha1, file.hash.sha256, _id, _version, _index","actions": []}
{"id": "48443056-76b6-45fd-8c12-60adad72f591","created_by": "elastic","name": "Encrypted C2 Channel Establishment","tags": ["DEMO"],"interval": "1m","enabled": true,"revision": 0,"description": "This detection rule identifies suspicious network activity by monitoring processes that use specific .NET classes and methods associated with secure network communications and data handling. It specifically looks for processes that start with command lines containing System.Net.Security.SslStream, AuthenticateAsClient, and GetBytes. These elements are often used in secure client-server communications and data manipulation, which can sometimes indicate unauthorized or malicious activity.","risk_score": 99,"severity": "critical","license": "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md","output_index": "","meta": {"from": "1s"},"author": ["celeroon"],"false_positives": [],"from": "now-61s","rule_id": "11f63885-ffaa-41f2-abab-807ad6ae0047","max_signals": 100,"risk_score_mapping": [],"severity_mapping": [],"threat": [{"framework": "MITRE ATT&CK","tactic": {"id": "TA0011","name": "Command and Control","reference": "https://attack.mitre.org/tactics/TA0011"},"technique": [{"id": "T1573","name": "Encrypted Channel","reference": "https://attack.mitre.org/techniques/T1573","subtechnique": []}]}],"to": "now","references": [],"version": 1,"exceptions_list": [],"immutable": false,"related_integrations": [],"required_fields": [],"setup": "","type": "esql","language": "esql","query": "FROM logs-* metadata _id, _version, _index\n| WHERE (event.category == \"process\" AND event.action == \"start\")\n    AND (\n        process.command_line LIKE \"*System.Net.Security.SslStream*\"\n        AND process.command_line LIKE \"*AuthenticateAsClient*\"\n        AND process.command_line LIKE \"*GetBytes*\"\n    )\n| KEEP event.code, @timestamp, process.entity_id, process.pid, process.name, process.command_line, _id, _version, _index","actions": []}
{"id": "110367cb-4c0e-4594-8225-ad53cd79b206","created_by": "elastic","name": "Suspicious PowerShell Web Request Execution","tags": ["DEMO"],"interval": "1m","enabled": true,"revision": 0,"description": "This detection rule is designed to identify potentially malicious PowerShell activities involving web requests that download and execute scripts or binaries. It focuses on PowerShell script block logs that utilize the Invoke-WebRequest command to access HTTP resources and retrieve files with extensions such as .exe, .py, or .ps1. This behavior is often associated with downloading and executing payloads from external sources, which could indicate a security breach or malicious intent.","risk_score": 73,"severity": "high","license": "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md","output_index": "","meta": {"from": "1s"},"author": ["celeroon"],"false_positives": [],"from": "now-61s","rule_id": "ba54ae95-fae3-4663-85ff-f35f21d05aa2","max_signals": 100,"risk_score_mapping": [],"severity_mapping": [],"threat": [{"framework": "MITRE ATT&CK","tactic": {"id": "TA0002","name": "Execution","reference": "https://attack.mitre.org/tactics/TA0002"},"technique": [{"id": "T1059","name": "Command and Scripting Interpreter","reference": "https://attack.mitre.org/techniques/T1059","subtechnique": [{"id": "T1059.001","name": "PowerShell","reference": "https://attack.mitre.org/techniques/T1059/001"}]}]}],"to": "now","references": [],"version": 1,"exceptions_list": [],"immutable": false,"related_integrations": [],"required_fields": [],"setup": "","type": "esql","language": "esql","query": "FROM logs-* metadata _id, _version, _index\n| WHERE event.code == \"4104\"\n    AND (\n        powershell.file.script_block_text LIKE \"*Invoke-WebRequest*\"\n        AND powershell.file.script_block_text LIKE \"*http*\"\n        AND (\n            powershell.file.script_block_text LIKE \"*.exe*\"\n            OR powershell.file.script_block_text LIKE \"*.py*\"\n            OR powershell.file.script_block_text LIKE \"*.ps1*\"\n        )\n    )\n| KEEP event.code, @timestamp, process.entity_id, process.pid, process.name, powershell.file.script_block_text, _id, _version, _index","actions": []}